import { MapExploiter } from "./MapExploiter.js";
import { TileExploiter } from "./TileExploiter.js";

export class CityExploiter {
  /** @type {Number | null} */
  #city_id;
  /** @typedef {Number} */
  #level = 1;
  /** @type {Number} */
  #populations = 0;
  /** @type {Number} */
  #total_populations = 0;
  /** @type {Number} */
  #stars_production;

  /** @type {TileExploiter[]} */
  tiles;

  /**
   * @param {TileExploiter} tile
   */
  constructor(tile) {
    this.tiles = [tile];
    this.#city_id = tile.city_id;
    this.#stars_production = this.#city_id === 1 ? 2 : 1;
  }

  get city_id() {
    return this.#city_id;
  }
  get level() {
    return this.#level;
  }
  get total_populations() {
    return this.#total_populations;
  }
  get stars_production() {
    return this.#stars_production;
  }

  /**
   * @param {TileExploiter} tile
   */
  addTile(tile) {
    this.tiles.push(tile);
  }

  /**
   * @param {Number} value
   * @param {MapExploiter} map
   */
  addPopulations(value, map) {
    this.#total_populations += value;
    this.#populations += value;
    if (this.#populations >= this.#level + 1) {
      this.#level++;
      this.#stars_production++;
      if (this.#level === 2) this.#stars_production++;
      else if (this.#level === 3) map.stars += 5;
      else if (this.#level === 4) this.#populations += 3;
      else if (this.#level >= 5) this.#stars_production++;
      this.#populations -= this.#level;
    }
  }
}
