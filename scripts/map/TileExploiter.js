import { MapExploiter } from "./MapExploiter.js";
import { Tile } from "./Tile.js";
import { TileGenerator } from "./TileGenerator.js";

export class TileExploiter extends Tile {
  /** @type {Number | null} */
  #city_id = null;
  /** @type {Boolean} */
  known = false;

  /** @type {Biome} */
  #biome;
  /** @type {Resource} */
  #resource;
  /** @type {Building} */
  #building = null;

  /** @type {TypeAction[]} */
  actionsPossible = [];

  /**
   * @param {TileGenerator} tileGenerator
   */
  constructor(tileGenerator) {
    super(tileGenerator.row, tileGenerator.col);
    this.#biome = tileGenerator.biome;
    this.#resource = tileGenerator.resource;
    this.known = tileGenerator.known;
    if (tileGenerator.isCapitalCity) this.#city_id = 1;
  }

  get city_id() {
    return this.#city_id;
  }
  get biome() {
    return this.#biome;
  }
  get resource() {
    return this.#resource;
  }
  get building() {
    return this.#building;
  }

  addAction(stars, action) {
    if (stars > MapExploiter.cost[action]) this.actionsPossible.push(action);
  }

  defineActionsPossible(stars) {
    this.actionsPossible = [];
    if (this.#city_id) {
      if (!this.#building) {
        if (this.#biome === "mountain") {
          if (this.#resource === "metal") this.addAction(stars, "mine");
          this.addAction(stars, "mountain temple");
        }
        if (this.#biome === "forest") {
          if (this.#resource === "animal") this.addAction(stars, "hunting");
          this.addAction(stars, "forest temple");
          this.addAction(stars, "clear forest");
          this.addAction(stars, "burn forest");
          this.addAction(stars, "lumber hut");
        }
        if (this.#biome === "field") {
          if (this.#resource === "fruit") this.addAction(stars, "harvest");
          if (this.#resource === "crop") this.addAction(stars, "farm");
          this.addAction(stars, "temple");
          this.addAction(stars, "grow forest");
        }
      }
    }
  }

  /**
   * @param {TypeAction} action
   */
  applyAction(action) {
    if (this.actionsPossible.includes(action)) {
      switch (action) {
        case "hunting":
        case "harvest":
          this.#resource = null;
          break;
        case "farm":
        case "mine":
        case "lumber hut":
        case "mountain temple":
        case "forest temple":
        case "temple":
          this.#building = action;
          break;
        case "clear forest":
          this.#biome = "field";
          this.#resource = null;
          break;
        case "grow forest":
          this.#biome = "forest";
          this.#resource = null;
          break;
        case "burn forest":
          this.#biome = "field";
          this.#resource = "crop";
          break;
        default:
      }
    }
  }
}
